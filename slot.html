<!DOCTYPE html>
<html lang="id">
<head>
  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mahjong Slot UI</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
Â  const supabase = window.supabase.createClient(
Â  Â  'https://kbypmtqhxcvfqtsggndy.supabase.co',
Â  Â  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtieXBtdHFoeGN2ZnF0c2dnbmR5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgwMTQ0MzksImV4cCI6MjA2MzU5MDQzOX0.CChsDYoTN3OI36QmZNCBS_xKEmCjkUsFAonD8gN2Qj0'
Â  );
Â  const uid = localStorage.getItem('uid');
</script>
  <style>
    * {
      box-sizing: border-box;
    }
body {
  background: linear-gradient(270deg, #fff89a, blue, yellow, red); /* Ubah warna sesuai selera */
  background-size: 150% 40%; 
  animation: gradientAnimation 5s ease infinite; 
  margin: 0;
  font-family: 'Poppins', sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 3px 10px;
  color: #fff;
}

@keyframes gradientAnimation {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

    h1 {
      font-size: 2em;
      color: gold;
      margin-bottom: 15px;
      text-shadow: 2px 2px 6px #000;
      text-align: center;
      margin: -10px;
    }
    .slot-frame {
      background: #fff;
      padding: 0px;
      border-radius: 2px;
      box-shadow: inset 0 0 4px rgba(0,0,0,0.3);
      border: 2px solid #fff;
    }
    .slot-grid {
      display: grid;
      grid-template-columns: repeat(5, 70px);
      grid-template-rows: repeat(6, 85px);
      gap: 0px;
      justify-content: center;
      border: 1px solid red;
    
    }
    .tile {
      background: ;
      border-radius: 0px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      font-weight: bold;
      box-shadow: 0 9px 9px rgba(0,0,0,0.2);
      transition: transform 10s ease;
    }
    .tile.break {
      animation: breakAnim 1.9s forwards;
    }
    @keyframes breakAnim {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(0); opacity: 1; }
    }
    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #444;
      color: gold;
      padding: 20px 30px;
      border: 2px solid gold;
      border-radius: 10px;
      font-size: 1em;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      z-index: 9999;
      display: none;
    }
    .controls {
      margin-top: 15px;
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .balance, .bet-display {
      background: #000;
      padding: 6px 4px;
      border-radius: 10px;
      color: red;
      border: 2px solid gold;
      font-size: 10px;
      font-weight: bold;
    }
    .multiplier {
     border: 1px solid gold;
      position: fixed;
      top: 53px;
      background: black;
      padding: 0px 5px;
      border-radius: 0px;
      color: #f0c04d;
      font-size: 23px;
      font-weight: bold;
    }
    .spin-button {
      background: black;
      border: 2px solid gold;
      border-radius: 100%;
      width: 50px;
      height: 50px;
      font-size: 20px;
      font-weight: bold;
      color: #000;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    }
    .bet-controls button {
      background: #222;
      color: white;
      border: 1px solid gold;
      border-radius: 100px;
      padding: 6px 6px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <marquee>â€¢nikmati keseruan bermain dengan kemanangan yang tidak pernah terbayangkanâ€¢lakukan strategi agar dapat memenangkan permain dan dapatkan uang secara mudah</marquee>
  <audio id="rollSound" src="https://www.soundjay.com/misc/sounds/slot-machine-01.mp3"></audio>
<audio id="winSmallSound" src="https://www.soundjay.com/button/sounds/button-3.mp3"></audio>
<audio id="winBigSound" src="https://www.soundjay.com/misc/sounds/cash-register-01.mp3"></audio>
  <audio id="breakSound" src="https://www.soundjay.com/button/sounds/button-29.mp3"></audio>
  <div id="popup" class="popup"></div>
  
  <h1>GAME ZONE<hr></h1>
  <div class="slot-frame">
    <div class="slot-grid" id="grid"></div>
  </div>

  <div class="controls">
<div class="balance" id="balanceDisplay">Saldo: Rp0</div>
    <div class="bet-controls">
      <button id="betMinus">-</button>
      <span class="bet-display" id="betDisplay">100</span>
      <button id="betPlus">+</button>
    </div>
    <button class="spin-button" id="spinButton">ðŸª™</button>
    <div class="multiplier" id="multiplierDisplay">x0</div>
  </div>

<audio id="spinSound" src="https://www.soundjay.com/button/sounds/button-16.mp3"></audio>
<audio id="bgm" src="https://www.bensound.com/bensound-music/bensound-epic.mp3" loop></audio>

  <script>
    const grid = document.getElementById('grid');
    const spinButton = document.getElementById('spinButton');
    const balanceDisplay = document.getElementById('balanceDisplay');
    const betDisplay = document.getElementById('betDisplay');
    const multiplierDisplay = document.getElementById('multiplierDisplay');
    const rollSound = document.getElementById('rollSound');
    const betMinusBtn = document.getElementById('betMinus');
    const betPlusBtn = document.getElementById('betPlus');
       const symbolPayouts = {
        'ðŸ“': 20,
 Â  'ðŸ’': 20,
 Â  'ðŸ': 50,
 Â  'ðŸˆ': 10,
 Â  'ðŸ¥­': 15,
 Â  'ðŸŠ': 15,
 Â  'ðŸ¥‘': 50,
 Â  'ðŸ': 20,
 Â  'ðŸ‡': 20,
 Â  'ðŸŒ': 20,
   'ðŸ': 30,
 }
    const width = 5;
    const height = 6;
    const symbols = ['ðŸŒ', 'ðŸ‡', 'ðŸ', 'ðŸ¥‘', 'ðŸ¥­', 'ðŸ', 'ðŸˆ', 'ðŸ', 'ðŸŠ', 'ðŸ“', 'ðŸ’'];
    let currentSymbols = [];
    let balance = 0; // sementara 0, isi dari Supabase nanti

 async function loadSaldo() {
Â  if (!uid) {
Â  Â  alert("User belum login!");
Â  Â  window.location.href = "index.html"; // redirect ke login kalau belum login
Â  Â  return;
Â  }

Â  const { data, error } = await supabase
Â  Â  .from('users_data')
Â  Â  .select('saldo')
Â  Â  .eq('user_id', uid)
Â  Â  .single();

Â  if (error || !data) {
Â  Â  alert("Gagal mengambil saldo user!");
Â  Â  return;
Â  }

Â  balance = data.saldo;
Â  updateBalance(0);
}

window.onload = () => {
Â  loadSaldo();
Â  init(); // jalankan game
};

    let bet = 100;
    const minBet = 50;
    const maxBet = 1000;
    let multiplier = 0;

    function generateRandomSymbols() {
      const arr = [];
      for (let i = 0; i < width * height; i++) {
        arr.push(symbols[Math.floor(Math.random() * symbols.length)]);
      }
      return arr;
    }

    function renderGrid(symbolsArr) {
      grid.innerHTML = '';
      symbolsArr.forEach(sym => {
        const div = document.createElement('div');
        div.className = 'tile';
        div.textContent = sym;
        grid.appendChild(div);
      });
    }

function animateReelShake(col) {
  return new Promise(resolve => {
    const reelSymbols = [];
    for (let row = 0; row < height; row++) {
      reelSymbols.push(currentSymbols[row * width + col]);
    }

    const reelTiles = [];
    for (let row = 0; row < height; row++) {
      reelTiles.push(grid.children[row * width + col]);
    }

    let position = 1;
    const tileHeight = 10;
    const totalScrolls = 10 + col * 5;
    let scrollCount = 0;

    const rollSound = document.getElementById('rollSound');
    rollSound.currentTime = 0;
    rollSound.play();
     
    function step() {
Â  position += 5;
Â  if (position >= tileHeight) {
Â  Â  position -= tileHeight;
Â  Â  scrollCount++;

Â  Â  reelSymbols.unshift(symbols[Math.floor(Math.random() * symbols.length)]);
Â  Â  reelSymbols.pop();

Â  Â  for (let r = 0; r < height; r++) {
Â  Â  Â  reelTiles[r].textContent = reelSymbols[r];
Â  Â  }
Â  }

Â  for (let r = 0; r < height; r++) {
Â  Â  reelTiles[r].style.transform = `translateY(${Math.sin(scrollCount / totalScrolls * Math.PI) * -20}px)`;
Â  }

Â  if (scrollCount >= totalScrolls) {
Â  Â  for (let r = 0; r < height; r++) {
Â  Â  Â  reelTiles[r].style.transform = 'translateY(0)';
Â  Â  }
Â  Â  rollSound.pause();
Â  Â  rollSound.currentTime = 0;

Â  Â  for (let r = 0; r < height; r++) {
Â  Â  Â  currentSymbols[r * width + col] = reelSymbols[r];
Â  Â  }

Â  Â  resolve();
Â  } else {
Â  Â  requestAnimationFrame(step);
Â  }
}

    step();
  });
}

    function getWinningTiles(symbolsArr) {
   Â  const winningTiles = new Set();

   Â  for (const symbol of symbols) {
 Â  Â  let consecutiveColumns = 0;
 Â  Â  const matchedIndices = [];

 Â  Â  for (let col = 0; col < width; col++) {
 Â  Â  Â  let foundInColumn = false;

 Â  Â  Â  for (let row = 0; row < height; row++) {
 Â  Â  Â  Â  const index = row * width + col;
 Â  Â  Â  Â  if (symbolsArr[index] === symbol) {
 Â  Â  Â  Â  Â  matchedIndices.push(index);
 Â  Â  Â  Â  Â  foundInColumn = true;
 Â  Â  Â  Â  }
 Â  Â  Â  }

 Â  Â  Â  if (foundInColumn) {
 Â  Â  Â  Â  consecutiveColumns++;
 Â  Â  Â  Â  if (consecutiveColumns >= 3 && col === width - 1) {
 Â  Â  Â  Â  Â  matchedIndices.forEach(i => winningTiles.add(i));
 Â  Â  Â  Â  }
 Â  Â  Â  } else {
 Â  Â  Â  Â  if (consecutiveColumns >= 3) {
 Â  Â  Â  Â  Â  matchedIndices.forEach(i => winningTiles.add(i));
 Â  Â  Â  Â  }
 Â  Â  Â  Â  break;
 Â  Â  Â  }
 Â  Â  }
 Â  }
     Â  return Array.from(winningTiles);
}
      function animateWinningTiles(indices) {
      const sound = document.getElementById('breakSound');
      document.querySelectorAll('.tile').forEach((tile, i) => {
        if (indices.includes(i)) {
          tile.classList.add('break');
        }
      });
      sound.play();
    }
    async function handleTileCollapse(winningIndices) {
      const delay = ms => new Promise(res => setTimeout(res, ms));
      animateWinningTiles(winningIndices);
      await delay(500);
      for (let i = 0; i < currentSymbols.length; i++) {
        if (winningIndices.includes(i)) {
          currentSymbols[i] = null;
        }
      }
      for (let col = 0; col < width; col++) {
        const colSymbols = [];
        for (let row = height - 1; row >= 0; row--) {
          const idx = row * width + col;
          if (currentSymbols[idx] !== null) {
            colSymbols.unshift(currentSymbols[idx]);
          }
        }
         const sound = document.getElementById('breakSound');
         sound.play();
        
         while (colSymbols.length < height) {
          colSymbols.unshift(symbols[Math.floor(Math.random() * symbols.length)]);
        }
        for (let row = 0; row < height; row++) {
          currentSymbols[row * width + col] = colSymbols[row];
        }
      }
      renderGrid(currentSymbols);
    }
    function updateBalance(amount) {
Â  balance += amount;
Â  balanceDisplay.textContent = `Saldo: Rp${balance}`;
}

    function updateBetDisplay() {
      betDisplay.textContent = `${bet}`;
    }
    function showPopup(message) {
      const popup = document.getElementById('popup');
      popup.textContent = message;
      popup.style.display = 'block';
      setTimeout(() => {
        popup.style.display = 'none';
      }, 1000);
    }

async function spin() {
  if (balance < bet) return;
  const spinSound = document.getElementById('spinSound');
  spinSound.currentTime = 0;
  spinSound.play();

  updateBalance(-bet);
  spinButton.disabled = true;

  multiplier = 0;
  multiplierDisplay.textContent = `x${multiplier}`;

  rollSound.currentTime = 0;
  rollSound.play();

  for (let col = 0; col < width; col++) {
    await animateReelShake(col);
  }

  rollSound.pause();
  rollSound.currentTime = 0;

  let totalWin = 0;
  while (true) {
    const winTiles = getWinningTiles(currentSymbols);
    if (winTiles.length === 0) break;
    multiplier = Math.min(multiplier + 1, 5);
    multiplierDisplay.textContent = `x${multiplier}`;
    await handleTileCollapse(winTiles);
   let symbolCount = {};
    winTiles.forEach(i => {
 Â  const sym = currentSymbols[i];
 Â  symbolCount[sym] = (symbolCount[sym] || 0) + 1;
});

   for (let sym in symbolCount) {
 Â  const count = symbolCount[sym];
 Â  const payout = symbolPayouts[sym] || 1;
 Â  totalWin += count * payout * (bet / 100) * multiplier;
  }

    await new Promise(res => setTimeout(res, 300));
  }

  multiplier = 0;
  multiplierDisplay.textContent = `x${multiplier}`;
  updateBalance(totalWin);
  // Sync saldo ke Supabase
await supabase
Â  .from('users_data')
Â  .update({ saldo: balance })
Â  .eq('user_id', uid);


  if (totalWin > 0) {
    if (totalWin >= bet * 10) {
      document.getElementById('winBigSound').play();
    } else {
      document.getElementById('winSmallSound').play();
    }
    showPopup(`You won $${totalWin}!`);
  }

  spinButton.disabled = false;
}

    betMinusBtn.onclick = () => {
      if (bet - 100 >= minBet) {
        bet -= 100;
        updateBetDisplay();
      }
    };
    betPlusBtn.onclick = () => {
      if (bet + 100 <= maxBet && bet + 100 <= balance) {
        bet += 100;
        updateBetDisplay();
      }
    };
    spinButton.onclick = spin;

  const bgm = document.getElementById('bgm');
  bgm.volume = 0.3;

  function init() {
  currentSymbols = generateRandomSymbols();
  renderGrid(currentSymbols);
  updateBalance(0);
  updateBetDisplay();

  const bgm = document.getElementById('bgm');
  bgm.volume = 0.3;
  bgm.play().catch(() => {
    document.body.addEventListener('click', () => {
      bgm.play();
    }, { once: true });
  });
}

  init();
</script>
</body>
  </html>
  
