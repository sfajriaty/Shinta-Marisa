<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Profil Pemain - GameZone</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap');
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0; min-height: 100vh;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    color: #fff;
  }
  .container {
    max-width: 600px;
    margin: 40px auto 80px;
    background: rgba(0,0,0,0.6);
    border-radius: 15px;
    padding: 30px 40px;
    box-shadow: 0 0 25px 4px rgba(255,165,0,0.5);
  }
  h1 {
    text-align: center;
    color: #ff9500;
    text-shadow: 0 0 12px #ffb347;
    margin-bottom: 30px;
  }
  .saldo {
    font-size: 22px;
    font-weight: 700;
    text-align: center;
    margin-bottom: 25px;
    color: #ffb347;
  }
  .btn-group {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 30px;
  }
  .btn {
    background: #ff9500;
    border: none;
    border-radius: 30px;
    padding: 12px 25px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    color: #fff;
    box-shadow: 0 0 12px #ffb347;
    transition: background 0.3s;
  }
  .btn:hover {
    background: #ffb347;
  }
  h2 {
    border-bottom: 2px solid #ff9500;
    padding-bottom: 8px;
    margin-bottom: 15px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 30px;
  }
  th, td {
    padding: 10px 12px;
    text-align: left;
    border-bottom: 1px solid #444;
  }
  th {
    background: #ff9500;
    color: #222;
  }
  .empty {
    color: #bbb;
    font-style: italic;
    text-align: center;
    padding: 15px 0;
  }
  @media (max-width: 480px) {
    .container {
      margin: 20px 15px 60px;
      padding: 20px 25px;
    }
    .btn-group {
      flex-direction: column;
      gap: 12px;
    }
    .btn {
      width: 100%;
    }
  }
</style>
</head>
<body>

<div class="container">
  <h1>Profil Pemain</h1>
  <div class="saldo" id="saldo-display">Saldo: Rp0</div>
  <div class="btn-group">
    <button class="btn" onclick="window.location.href='deposit.html'">Deposit</button>
    <button class="btn" onclick="window.location.href='withdraw.html'">Penarikan</button>
    <button class="btn" id="btn-main-game">Mainkan Game</button>
  </div>

  <h2>Riwayat Deposit</h2>
  <table id="riwayat-deposit">
    <thead>
      <tr><th>Tanggal</th><th>Jumlah (Rp)</th></tr>
    </thead>
    <tbody>
      <tr><td colspan="2" class="empty">Memuat data...</td></tr>
    </tbody>
  </table>

  <h2>Riwayat Penarikan</h2>
  <table id="riwayat-penarikan">
    <thead>
      <tr><th>Tanggal</th><th>Jumlah (Rp)</th></tr>
    </thead>
    <tbody>
      <tr><td colspan="2" class="empty">Memuat data...</td></tr>
    </tbody>
  </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const supabase = window.supabase.createClient(
    'https://kbypmtqhxcvfqtsggndy.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtieXBtdHFoeGN2ZnF0c2dnbmR5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgwMTQ0MzksImV4cCI6MjA2MzU5MDQzOX0.CChsDYoTN3OI36QmZNCBS_xKEmCjkUsFAonD8gN2Qj0'
  );

  async function loadProfile() {
    const uid = localStorage.getItem('uid');
    if (!uid) {
      alert('Silakan login terlebih dahulu.');
      window.location.href = 'index.html'; // arahkan ke halaman login/register
      return;
    }

    // Ambil saldo
    const { data: userData, error: userError } = await supabase
      .from('users_data')
      .select('saldo')
      .eq('user_id', uid)
      .single();

    if (userError) {
      alert('Gagal memuat data saldo.');
      return;
    }

    document.getElementById('saldo-display').textContent = `Saldo: Rp${userData.saldo ?? 0}`;

    // Ambil riwayat deposit
    const { data: depositData, error: depositError } = await supabase
      .from('deposit_history')
      .select('created_at, amount')
      .eq('user_id', uid)
      .order('created_at', { ascending: false });

    const depositTableBody = document.querySelector('#riwayat-deposit tbody');
    depositTableBody.innerHTML = '';
    if (depositError || !depositData || depositData.length === 0) {
      depositTableBody.innerHTML = '<tr><td colspan="2" class="empty">Belum ada riwayat deposit.</td></tr>';
    } else {
      depositData.forEach(row => {
        const date = new Date(row.created_at).toLocaleString('id-ID');
        depositTableBody.innerHTML += `<tr><td>${date}</td><td>Rp${row.amount}</td></tr>`;
      });
    }

    // Ambil riwayat penarikan
    const { data: withdrawData, error: withdrawError } = await supabase
      .from('withdraw_history')
      .select('created_at, amount')
      .eq('user_id', uid)
      .order('created_at', { ascending: false });

    const withdrawTableBody = document.querySelector('#riwayat-penarikan tbody');
    withdrawTableBody.innerHTML = '';
    if (withdrawError || !withdrawData || withdrawData.length === 0) {
      withdrawTableBody.innerHTML = '<tr><td colspan="2" class="empty">Belum ada riwayat penarikan.</td></tr>';
    } else {
      withdrawData.forEach(row => {
        const date = new Date(row.created_at).toLocaleString('id-ID');
        withdrawTableBody.innerHTML += `<tr><td>${date}</td><td>Rp${row.amount}</td></tr>`;
      });
    }
  }

  document.getElementById('btn-main-game').addEventListener('click', () => {
    window.location.href = 'slot.html';
  });

  window.onload = loadProfile;
</script>
</body>
</html>
